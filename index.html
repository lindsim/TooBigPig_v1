<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="style.css"/>
	
</head>
<body>
	<p class="center">Too Big Pig <img src="images/pigface.png" id="pigface"></p>
	<div class="gameContain">
		<img src="images/failpig.png" id="failpig">
			
		<div class="controls">
				<input type="text" id="userGuess" class="textBox" name="guess" placeholder="How big pig?"/>
				<button id="submit" class="pigButt">Pig Magic!</button>
				<button id="next" class="pigButt">Next</button>
				<button id="quit" class="quitButt">Quit</button>
				<button id="start" class="startButt">New Game</button>

		</div>
		
		<div class="messages">
			<div class="scoreMessage"></div>
			<div class="gameResult"></div>
		</div>
			
	
		
		<main class="stage">
			<img src="images/field.png" width="100%" id="field">
			<img src="images/mud.png" id="mud">
			<img src="images/shades.png" id="shades">
			
		
		</main>

	</div>
<script src="https://cdn.firebase.com/js/client/2.2.4/firebase.js"></script>
<script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
<script>

var ref = new Firebase("https://too-big-pig-1.firebaseio.com/scores");
var best_pig = 100;
var pig = "images/pigface.png";
var box = 0;
var score = 0;

$('#shades').hide();
$('#mud').hide();
$('#failpig').hide();
$('#userGuess').hide();
$('#submit').hide();
$('#next').hide();
$('#quit').hide();
$('.scoreMessage').hide();

$(document).ready(function(){
	$('.gameResult').text('Let\'s play!');
	$('#start').click(newGame);
	$('#quit').click(endGame);
	$('#pigface').click(swapFace);
	$('#submit').click(scoreIt);
	$('#next').click(newPond);
});


var newGame = function(){
	if (box != 1){
		score = 0;
		$('#failpig').hide();
	 	$('#userGuess').show();
	 	$('#quit').show();
	 	$('#submit').show();
		$('.scoreMessage').text("Score:" + score);
		$('.scoreMessage').show();
		$('#start').hide();
		$('#userGuess').val("");
		box = 1;
		newPond();
	}
};

var endGame = function() {

	box = 0;
	checkscore(score);
	$('#next').hide();
	$('#userGuess').hide();
	$('#submit').hide();
	$('#start').show();
	$('#quit').hide();
	$('#shades').hide();
	$('#mud').hide();
	$('.scoreMessage').text('Score:' + score);
};

var newPond = function(){
	$('#failpig').hide();
	$('.gameResult').hide();
	$('.gameOver').hide();
	$('#next').hide();
	$('#shades').hide();
	$('#submit').show();
	$('#userGuess').show();
	$('#userGuess').val("");
	var r = Math.round(Math.random()*(100 - 10) + 10);
	$('#mud').attr('width', ( 620 * r/100));
	$('#mud').show();
	best_pig = r;
}



var swapFace = function(){
	if (pig == "images/pigface.png"){
		pig = "images/winkpig.png";
	}
	else if (pig == "images/winkpig.png"){
		pig = "images/pigface.png";
	}

	$(this).attr('src', pig);
}


var scoreIt = function() {
 	var guess = $('#userGuess').val();

	if(guess > best_pig){
		$('.gameResult').show();
		$('.gameResult').text("TOO BIG PIG!");
		$('#failpig').show()
		endGame();
		}

	else if (guess == 0){
		alert('No size zero pigs! Pig magic works from 10 to 100.  Try again.');
	}

	else if (guess < best_pig && guess > 0){
		$('.gameResult').text('The pig fits!');
		$('.gameResult').show();
		var newPoints = Math.round((1000 * (guess/best_pig)));
		score += newPoints;
		$('#submit').hide();
		$('#next').show();
		$('#shades').attr('width', (guess * 3.5));
		$('#shades').show();
		$('.scoreMessage').text("Score:" + score);
		}

	else if (guess == best_pig){
		$('.gameResult').show();
		$('.gameResult').text('Perfect pig!!!');
		score += 1500;
		$('#submit').hide();
		$('#next').show();
		$('#shades').attr('width', (guess * 3.5));
		$('#shades').show();
		$('.scoreMessage').text("Score:" + score);
		}

	else {
		alert('That pig can\'t exist. Pig magic works from 10 to 100. Try again.');
	}
}

var checkscore = function(scr) {
	var items = [];
	//console.log("Ref =");
	//console.log(ref);
	ref.orderByValue().once("value", function(snapshot) {
		snapshot.forEach(function(data) {
			items.push([data.val(), data.key()]);
		});
		//console.log(items);
		if (scr >= items[0][0]) {
				changeScores(items, scr);
			}	
	});
}


var changeScores = function(items, s){
		var name = prompt("Top score! That'll do pig. Enter your initials (3 characters):") +"___";
		var shortName = name.substring(0,3);
		var obj = {};
		obj[shortName] = s;
		ref.update(obj);
//trim to 10
		var subRef = new Firebase("https://too-big-pig-1.firebaseio.com/scores"+"/" + items[0][1]);
		
		subRef.remove();
		
		if (confirm("Go to top score page?")) {
			location.href = "scores.html";
		}
 
	}


</script>

<p class="link"><a href="scores.html">Top Scores</a> /////////// created by <a href="https://github.com/lindsim/TooBigPig_v1">Lindsey Simard</a></p>


</body>
</html>
